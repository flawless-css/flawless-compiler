#!/usr/bin/env node

/**
 * Flawless
 * ---
 *
 * @flag -s --silent suppresses output logs
 * @argument filename to parse and compile
 *
 * @usage
 * flawless ./spec/fixtures.less
 * flawless < ./spec/fixtures.less > test.css
 */

var fs = require( 'fs' );
var path = require( 'path' );

var chalk = require( 'chalk' );
var argv = require( 'minimist' )( process.argv.slice( 2 ) )
var Flawless = require( '../dist' )
var flawless = new Flawless()
var log = require( '../dist/log' )


if ( process.stdin.isTTY && !argv._[ 0 ] ) {
    log.error( 'Supply input file' )
    process.exit( 1 )
}


// Suppress logs by default
log.suppress( true )


// Check for file
var filepath
var file = argv._[ 0 ]
if ( file ) {
    filepath = path.join( process.env.PWD, file )
    fs.stat( filepath, function( err ) {
        if ( !argv.s && !argv.silent ) log.suppress( false )
        if ( err ) return log.error( 'Input file not found' )
        fs.createReadStream( filepath )
            .pipe( flawless )
            .pipe( process.stdout )
    })
}

// Pipe input
if ( !file ) {
    process.stdin.pipe( flawless ).pipe( process.stdout )
}
